apiVersion: apps/v1
kind: Deployment
metadata:
  name: artifact-loader
spec:
  replicas: 1
  selector:
    matchLabels:
      app: artifact-loader
  template:
    metadata:
      labels:
        app: artifact-loader
    spec:
      containers:
      - name: artifact-loader
        image: alpine:3.18
        command: ["/bin/sh", "-c"]
        args:
          - |
            apk add --no-cache curl unzip && \
            if [ ! -f /mnt/artifact/artifact.zip ]; then
              echo "File not found. Downloading..." && \
              curl -sSL -o /mnt/artifact/artifact.zip "$ARTIFACT_URL" && \
              unzip -o /mnt/artifact/artifact.zip -d /mnt/artifact;
            else
              echo "File already exists. Skipping download.";
            fi && \
            tail -f /dev/null
        env:
        - name: ARTIFACT_URL
          value: "https://artifactory.example.com/path/to/your.zip"
        volumeMounts:
        - name: artifact-volume
          mountPath: /mnt/artifact
      volumes:
      - name: artifact-volume
        persistentVolumeClaim:
          claimName: my-artifact-pvc
